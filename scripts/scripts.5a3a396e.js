"use strict";angular.module("orphaApp",["ngAnimate","ngSanitize","ngResource","ui.router","truncate","restangular","ui.bootstrap","dotjem.angular.tree","ui.utils"]).run(["$rootScope","$http","$state","$stateParams","Page",function(a,b,c,d,e){a.$state=c,a.$stateParams=d,a.Page=e,a.getResults=function(a){var c=encodeURIComponent(a),d="http://130.56.248.140/orphanet/api/search_node/retrieve.json?keys="+c+"&simple=1";return b.get(d).then(function(a){return a.data})},a.changed=function(a,b,d){console.log(a,b,d);var e={};e[a.type.toLowerCase()+"Id"]=a.node,c.go(a.type.toLowerCase(),e),console.log(a.type.toLowerCase(),e)}}]).config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(a,b,c){c.setBaseUrl("http://130.56.248.140/orphanet/api"),b.otherwise("/disorders"),a.state("genes",{url:"/genes?page",controller:"GenesCtrl",templateUrl:"views/genes.html"}).state("gene",{url:"/gene/:geneId/disorders",controller:"GeneCtrl",templateUrl:"views/gene.html"}).state("sign",{url:"/sign/:signId/disorders",controller:"SignCtrl",templateUrl:"views/sign.html"}).state("disorder",{url:"/disorders/:disorderId",controller:"DisorderCtrl",templateUrl:"views/disorder.html"}).state("disorders",{url:"/disorders?page?signId",controller:"DisordersCtrl",templateUrl:"views/disorders.html"}).state("concept",{url:"/concept/:conceptId",controller:function(a,b){var c=b.get({nid:136402},function(){a.disorder=c})},templateUrl:"views/concept.html"})}]),angular.module("orphaApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("orphaApp").factory("Concept",["Restangular",function(a){var b=a.service("entity_node");return b}]),angular.module("orphaApp").filter("inSlicesOf",["$rootScope",function(a){console.log("staring in slice of!!");var b=function(b,c){if(c||(c=3),!angular.isArray(b)&&!angular.isString(b))return b;var d=_.groupBy(b,function(a,b){return Math.floor(b/c)});a.arraysinSliceOf=a.arraysinSliceOf||[];var e=null;return angular.forEach(a.arraysinSliceOf,function(a){angular.equals(a,d)&&(e=a)}),e?e:(a.arraysinSliceOf.push(d),d)};return b}]),angular.module("orphaApp").factory("Disorder",["$resource","$http","$q","RelationshipService",function(a,b,c,d){var e=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"disorder",nid:"@nid"},{get:{method:"GET",transformResponse:b.defaults.transformResponse.concat([function(a){return a.disorder_parent=_.map(a.disorder_parent,function(a){return new e(a)}),_.each(a.disorder_inheritance,function(a){a.label="Autosomal dominant"===a.toi_name?"AD":"Autosomal recessive"===a.toi_name?"AR":a.toi_name}),a}])}});return angular.extend(e.prototype,{getGenes:function(){var a=["disgene_as","disgene_at","disgene_gene"];return d.getRelatedThroughIntermediary(this,"disorder_disgene",a)},getSigns:function(){var a=["ds_sign","ds_frequency"];return d.getRelatedThroughIntermediary(this,"disorder_phenotype",a)},getParents:function(){var a=this,d=_.map(this.disorder_parent,function(a){return a.id||a.nid});if(!d.length)return c.when(null);var f=_.indexBy(d,function(a,b){return"parameters[nid]["+b+"]"});return f.fields=["nid","disorder_name","disorder_parent"].join(","),b.get("http://130.56.248.140/orphanet/api/entity_node",{params:f}).then(function(b){return a.disorder_parent=_.map(b.data,function(a){return new e(a)}),a.disorder_parent})}}),e.getFromSign=function(a){return b.get("http://130.56.248.140/orphanet/api/entity_node/"+a+"/nodes_field_ds_sign?fields=ds_disorder").then(function(a){var b=_.map(a.data,function(a){return new e(a.ds_disorder)});return b})},e.getFromGene=function(a){return b.get("http://130.56.248.140/orphanet/api/entity_node/"+a+"/nodes_field_disgene_gene?fields=disgene_disorder").then(function(a){var b=_.map(a.data,function(a){return new e(a.disgene_disorder)});return b})},e}]),angular.module("orphaApp").controller("DisorderCtrl",["$scope","$stateParams","Disorder","Page",function(a,b,c,d){function e(){a.disorder=c.get({nid:b.disorderId},function(a){a.getGenes(),a.getSigns(),d.setTitle(a.disorder_name)})}function f(a){a.isShowingParents=!a.isShowingParents,a.getParents().then(function(a){console.log("parents",a)})}e(),a.toggleParents=f}]),angular.module("orphaApp").factory("Gene",["$resource",function(a){var b=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"gene",nid:"@nid"});return angular.extend(b.prototype,{}),b}]),angular.module("orphaApp").service("RelationshipService",["$http",function(a){this.getRelatedThroughIntermediary=function(b,c,d){var e=_.first(b[c]);if(b[c].length){var f=_.pluck(b[c],"nid"),g=_.indexBy(f,function(a,b){return"parameters[nid]["+b+"]"});return g["paramaters[type]"]=e.type,g.fields=["nid","type","title"].concat(d).join(","),a.get("http://130.56.248.140/orphanet/api/entity_node",{params:g}).then(function(a){var d=a.data;b[c]=d})}}}]),angular.module("orphaApp").factory("Sign",["$resource","Gene","RelationshipService",function(a){var b=a("http://130.56.248.140/orphanet/api/entity_node/:nid",{"parameters[type]":"clinical_sign",nid:"@nid"});return angular.extend(b.prototype,{}),b}]),angular.module("orphaApp").controller("DisordersCtrl",["$scope","$timeout","$stateParams","Disorder",function(a,b,c,d){function e(){a.disorders=d.query({fields:"nid,disorder_name",page:a.page++})}function f(){d.query({fields:"nid,disorder_name",page:a.page++},function(b){a.disorders=a.disorders.concat(b)})}a.loadMore=f,a.page=0,e()}]),angular.module("orphaApp").controller("GenesCtrl",["$scope","Gene",function(a,b){function c(){d.genes=b.query({fields:"nid,gene_name"})}var d=a;c()}]),angular.module("orphaApp").controller("GeneCtrl",["$scope","$stateParams","Gene","Disorder",function(a,b,c,d){function e(){a.gene=c.get({nid:b.geneId},function(){}),d.getFromGene(b.geneId).then(function(b){a.disorders=b})}e()}]),angular.module("orphaApp").factory("SearchService",function(){return{}}),angular.module("orphaApp").controller("SignCtrl",["$scope","$stateParams","Disorder","Sign",function(a,b,c,d){function e(){a.sign=d.get({nid:b.signId}),c.getFromSign(b.signId).then(function(b){a.disorders=b})}e()}]),angular.module("orphaApp").directive("cmTree",function(){return{templateUrl:"views/cmtree.html",restrict:"E",scope:{disorder:"="},link:function(){}}}),angular.module("orphaApp").factory("Page",function(){function a(a){b.title=a+" - Orphanet"}var b={title:null,setTitle:a};return b});